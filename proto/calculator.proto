syntax = "proto3";

package calculator;

option go_package = "github.com/tainj/distributed_calculator2/pkg/api";

import "google/api/annotations.proto";

// ================== MAIN SERVICE ==================
service Calculator {
  // Calculate expression
  rpc Calculate(CalculateRequest) returns (CalculateResponse) {
    option (google.api.http) = {
      post: "/v1/calculate"
      body: "*"
    };
  }

  // Get result - via BODY
  rpc GetResult(GetResultRequest) returns (GetResultResponse) {
    option (google.api.http) = {
      post: "/v1/result"
      body: "*"
    };
  }

  // Get all examples - via body
  rpc GetAllExamples(GetAllExamplesRequest) returns (GetAllExamplesResponse) {
    option (google.api.http) = {
      post: "/v1/examples"
      body: "*"
    };
  }

  // Register - via body
  rpc Register(RegisterRequest) returns (RegisterResponse) {
    option (google.api.http) = {
      post: "/v1/register"
      body: "*"
    };
  }

  // Login - via body
  rpc Login(LoginRequest) returns (LoginResponse) {
    option (google.api.http) = {
      post: "/v1/login"
      body: "*"
    };
  }
}

// ================== MODELS ==================

message CalculateRequest {
  string expression = 1;
}

message CalculateResponse {
  string task_id = 1;
}

message GetResultRequest {
  string task_id = 1;
}

message GetResultResponse {
  oneof result {
    double value = 1;
    string error = 2;
  }
}

message GetAllExamplesRequest {}

message GetAllExamplesResponse {
  repeated Example examples = 1;
}

message Example {
  string id = 1;
  string expression = 2;
  bool calculated = 3;
  optional double result = 4;
  string created_at = 5;
  optional string error = 6; // ‚Üê New field!
}

message RegisterRequest {
  string email = 1;
  string password = 2;
}

message RegisterResponse {
  bool success = 1;
  string error = 2;
}

message LoginRequest {
  string email = 1;
  string password = 2;
}

message LoginResponse {
  bool success = 1;
  string token = 2;
  string user_id = 3;
  string error = 4;
}